function Lottery(f,e,c,b,a,d){this.conId=f;this.conNode=document.getElementById(this.conId);this.cover=e;this.coverType=c;this.background=null;this.backCtx=null;this.mask=null;this.maskCtx=null;this.lottery=null;this.lotteryType="image";this.width=b||300;this.height=a||100;this.clientRect=null;this.drawPercentCallback=d}Lottery.prototype={createElement:function(c,a){var d=document.createElement(c);for(var b in a){d.setAttribute(b,a[b])}return d},getTransparentPercent:function(l,c,k){var b=l.getImageData(0,0,c,k),d=b.data,e=[];for(var g=0,f=d.length;g<f;g+=4){var h=d[g+3];if(h<128){e.push(g)}}return(e.length/(d.length/4)*100).toFixed(2)},resizeCanvas:function(b,c,a){b.width=c;b.height=a;b.getContext("2d").clearRect(0,0,c,a)},drawPoint:function(a,c){this.maskCtx.beginPath();var b=this.maskCtx.createRadialGradient(a,c,0,a,c,30);b.addColorStop(0,"rgba(0,0,0,0.6)");b.addColorStop(1,"rgba(255, 255, 255, 0)");this.maskCtx.fillStyle=b;this.maskCtx.arc(a,c,30,0,Math.PI*2,true);this.maskCtx.fill();if(this.drawPercentCallback){this.drawPercentCallback.call(null,this.getTransparentPercent(this.maskCtx,this.width,this.height))}},bindEvent:function(){var e=this;var c=(/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));var b=c?"touchstart":"mousedown";var d=c?"touchmove":"mousemove";if(!c){var a=false;document.addEventListener("mouseup",function(f){a=false},false)}else{document.addEventListener("touchmove",function(f){if(a){f.preventDefault()}},false);document.addEventListener("touchend",function(f){a=false},false)}this.mask.addEventListener(b,function(g){a=true;var i=document.documentElement;if(!e.clientRect){e.clientRect={left:0,top:0}}var f=(c?g.touches[0].clientX:g.clientX)-e.clientRect.left+i.scrollLeft-i.clientLeft;var h=(c?g.touches[0].clientY:g.clientY)-e.clientRect.top+i.scrollTop-i.clientTop;e.drawPoint(f,h)},false);this.mask.addEventListener(d,function(g){if(!c&&!a){return false}var i=document.documentElement;if(!e.clientRect){e.clientRect={left:0,top:0}}var f=(c?g.touches[0].clientX:g.clientX)-e.clientRect.left+i.scrollLeft-i.clientLeft;var h=(c?g.touches[0].clientY:g.clientY)-e.clientRect.top+i.scrollTop-i.clientTop;e.drawPoint(f,h)},false)},drawLottery:function(){this.background=this.background||this.createElement("canvas",{style:"position:absolute;left:0;top:0;border-radius:10px;"});this.mask=this.mask||this.createElement("canvas",{style:"position:absolute;left:0;top:0;border-radius:10px; "});if(!this.conNode.innerHTML.replace(/[\w\W]| /g,"")){this.conNode.appendChild(this.background);this.conNode.appendChild(this.mask);this.clientRect=this.conNode?this.conNode.getBoundingClientRect():null;this.bindEvent()}this.backCtx=this.backCtx||this.background.getContext("2d");this.maskCtx=this.maskCtx||this.mask.getContext("2d");if(this.lotteryType=="image"){var b=new Image(),c=this;b.onload=function(){c.width=this.width;c.height=this.height;c.resizeCanvas(c.background,this.width,this.height);c.backCtx.drawImage(this,0,0);c.drawMask()};b.src=this.lottery}else{if(this.lotteryType=="text"){this.width=this.width;this.height=this.height;this.resizeCanvas(this.background,this.width,this.height);this.backCtx.save();this.backCtx.fillStyle="";this.backCtx.globalAlpha=0;this.backCtx.fillRect(0,0,this.width,this.height);this.backCtx.restore();this.backCtx.save();var a=12;this.backCtx.font="Bold "+a+"px Arial";this.backCtx.textAlign="center";this.backCtx.fillStyle="#ff0000";this.backCtx.fillText(this.lottery,this.width/2,this.height/2+a/2);this.backCtx.restore();this.drawMask()}}},drawMask:function(){this.resizeCanvas(this.mask,this.width,this.height);if(this.coverType=="color"){this.maskCtx.fillStyle=this.cover;this.maskCtx.fillRect(0,0,this.width,this.height);this.maskCtx.globalCompositeOperation="destination-out"}else{if(this.coverType=="image"){var a=new Image(),b=this;a.onload=function(){b.maskCtx.drawImage(this,0,0);b.maskCtx.globalCompositeOperation="destination-out"};a.src=this.cover}}},init:function(a,b){this.lottery=a;this.lotteryType=b||"image";this.drawLottery()}};